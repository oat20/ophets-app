<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCREEN@1</title>
    <link href="../node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">

        <ul class="nav nav-pills nav-justified" style="margin-top: 10px;">
            <li role="presentation"><a href="#">1. บันทึกรายการชำระเงิน</a></li>
            <li role="presentation"><a href="./screen2-1.html">2. รายการชำระเงิน</a></li>
            <li role="presentation"><a href="./screen2-2.html">3. รายงานยอดรวม</a></li>
        </ul>
    
        <!--<h1 class="text-center">บันทึกรายการชำระเงิน</h1>-->
        <hr>

        <div class="row">
            <!--<div class="col-md-2">
                <ul class="nav nav-pills nav-stacked">
                    <li role="presentation"><a href="#">1. บันทึกรายการชำระเงิน</a></li>
                    <li role="presentation"><a href="./screen2-1.html">2. รายการชำระเงิน</a></li>
                    <li role="presentation"><a href="./screen2-2.html">3. รายงานยอดรวม</a></li>
                </ul>
            </div>-->
            <!-- col -->
            <div class="col-md-12">
                <form id="frmSubmit" action="#" method="post">
                    <div class="row" style="margin-bottom: 10px;">
                        <div class="col-xs-12 col-sm-12 col-md-6">
                
                            <div class="form-group">
                                        <label>เลขที่</label>
                                        <input type="text" name="refid2" class="form-control input-lg">
                                    </div>
                
                            <div class="row">
                                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                                    <div class="form-group">
                                        <label>Name</label>
                                        <input type="text" class="form-control input-lg" name="cusName" required>
                                    </div>
                                </div>
                                <!-- col -->
                                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                                    <div class="form-group">
                                        <label>Surname</label>
                                        <input type="text" class="form-control input-lg" name="cusSurname" required>
                                    </div>
                                </div>
                                <!-- col -->
                            </div>
                            <!-- row -->
                
                            <div class="form-group">
                                <label>Company Name</label>
                                <input type="text" class="form-control input-lg" name="comName" required>
                            </div>
                
                            <div class="form-group">
                                <label>Mobile Phone</label>
                                <input type="tel" class="form-control input-lg" pattern="[0-9]{10}" name="mobile" required>
                            </div>
                
                            <div class="form-group">
                                <label>Payment</label>
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="payment" id="optionsRadios1" value="QR Promptpay" required>
                                        QR Promptpay
                                    </label>
                                </div>
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="payment" id="optionsRadios1" value="Cash" required>
                                        Cash
                                    </label>
                                </div>
                            </div>

                            <center>
                                <img src="https://via.placeholder.com/300?text=QR+Promptpay" class="img-thumbnail img-responsive">
                            </center>
                        </div>
                        <!-- col -->
                        <div class="col-xs-12 col-sm-12 col-md-6">
                            <div class="alert alert-info text-center">
                                <h4>Total Amount</h4>
                                <h1 id="sumpackage">0 Baht</h1>
                                <input type="hidden" name="totalamount">
                            </div>

                            <div class="form-group" id="checkPackage">
                                <label>Package</label>
                                <div id="packagelist">
                                    ...
                                </div>
                                <!--<div class="checkbox">
                                    <label>
                                        <input type="checkbox" data-toggle="radio" value="" data-price2="100" name="subscribe" required>
                                        Package 1 (100 Baht)
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" data-toggle="radio" value="" name="subscribe" data-price2="200" required>
                                        Package 2 (200 Baht)
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" data-toggle="radio" value="" name="subscribe" data-price2="300" required>
                                        Package 3 (300 Baht)
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" data-toggle="radio" value="" name="subscribe" data-price2="400" required>
                                        Package 4 (400 Baht)
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" data-toggle="radio" value="" name="subscribe" data-price2="500" required>
                                        Package 5 (500 Baht)
                                    </label>
                                </div>-->
                            </div>
                        </div>
                        <!-- col -->
                    </div>
                    <!-- row -->
                    <div class="row">
                        <div class="col-md-6">
                            <button type="submit" class="btn btn-primary btn-block btn-lg">พิมพ์ต้นฉบับ</button>
                        </div>
                        <div class="col-md-6">
                            <button type="button" class="btn btn-danger btn-block btn-lg">พิมพ์ฉบับร่าง</button>
                        </div>
                    </div>
                </form>
            </div>
            <!-- col -->
        </div>
        <!-- row -->

    </div>
    <!-- con -->
    
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="../node_modules/sweetalert2/dist/sweetalert2.all.min.js"></script>
    <script>
        $(document).ready(function () {

            $('.nav-justified li:first').addClass('active');

            //$('.nav-stacked li:first').addClass('active');

            $.ajax({ 
                "url": "./package_json.php", 
                "method": "GET" 
            }).done(function(response){
                console.log(response);

                var checkbox = '';
                response.map(function(item, index){
                    console.log(item);
                    checkbox += '<div class="checkbox">';
                    checkbox += '<label>';
                    checkbox += '<input type="checkbox" value="" data-price2="'+item.price+'" name="subscribe" required>';
                    checkbox += item.item+' ('+item.price+' Baht)';
                    checkbox += '</label>';
                    checkbox += '</div>';
                });
                $('#packagelist').html(checkbox);
            });

            $('input[name="subscribe"]').change(function () {
                var receiptNos2 = $('input[name="subscribe"]:checked').map(function () {
                    return $(this).data('price2');
                }).get();
                console.log(receiptNos2);

                var alertCount = $('#checkPackage [name="subscribe"]:checked').length;
                console.log(alertCount);

                const sum = receiptNos2.reduce((partialSum, a) => partialSum + a, 0);
                console.log(sum);
                console.log(Intl.NumberFormat().format(sum));

                $('#sumpackage').html(Intl.NumberFormat().format(sum) + ' Baht');
                $('input[name="totalamount"]').val(sum);
            });

            $('button').click(function () {
                if($("input[name=cusName]").val() != '' &&
                $("input[name=cusSurname]").val() != '' &&
                $("input[name=comName]").val() != '' &&
                $("input[name=mobile]").val() != '' &&
                $("input[name=subscribe[]]").val() != '' &&
                $("input[name=payment]").val() != ''){

                    var sum2 = $('#sumpackage').html();
                    Swal.fire({
                        icon: 'success',
                        title: sum2,
                        text: 'Confirm Payment',
                        showCancelButton: true,
                        confirmButtonText: 'OK',
                    }).then((result) => {
                        console.log(result);
                        if (result.isConfirmed) {
                            //Swal.fire('Saved!', '', 'success')
                            //location.href = "./screen2.html";
                            $('#frmSubmit').submit();
                        }
                    });

                }
            });

        });
    </script>
</body>
</html>
